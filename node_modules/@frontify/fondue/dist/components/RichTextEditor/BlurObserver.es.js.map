{"version":3,"file":"BlurObserver.es.js","sources":["../../../src/components/RichTextEditor/BlurObserver.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { floatingLinkActions, useEditorRef, useFloatingLinkSelectors } from '@udecode/plate';\nimport { useCallback, useEffect } from 'react';\n\nexport const BlurObserver = ({\n    hideExternalFloatingModals,\n}: {\n    hideExternalFloatingModals?: (editorId: string) => void;\n}) => {\n    const editorRef = useEditorRef();\n    const isFloatingLinkModalOpen = useFloatingLinkSelectors().isOpen(editorRef.id);\n\n    const collapseFloatingModals = useCallback(() => {\n        if (isFloatingLinkModalOpen) {\n            floatingLinkActions.reset();\n        }\n        if (hideExternalFloatingModals) {\n            hideExternalFloatingModals(editorRef.id);\n        }\n    }, [isFloatingLinkModalOpen, hideExternalFloatingModals, editorRef]);\n\n    const collapseEverything = useCallback(() => {\n        editorRef.collapse();\n        collapseFloatingModals();\n    }, [editorRef, collapseFloatingModals]);\n\n    useEffect(() => {\n        const handleInteractWithOutside = (event: FocusEvent | MouseEvent) => {\n            const richTextEditorSelector = `[data-editor-id='${editorRef.id}']`;\n            const toolbarSelector = \"[data-selector='toolbar-floating']\";\n            const modalSelector = '[data-is-underlay]';\n            const richTextEditorWrapper = document.querySelector<HTMLDivElement>(richTextEditorSelector);\n            const toolbarWrapper = document.querySelector<HTMLDivElement>(toolbarSelector);\n            const modalWrapper = document.querySelector<HTMLDivElement>(modalSelector);\n            const targetElement = event.target as HTMLElement;\n\n            const isTargetInsideModal = modalWrapper?.contains(targetElement);\n            const isTargetInsideRichTextEditor = richTextEditorWrapper?.contains(targetElement);\n            const isTargetInsideRichTextEditorToolbar = toolbarWrapper?.contains(targetElement);\n\n            if (isTargetInsideRichTextEditorToolbar) {\n                collapseFloatingModals();\n            }\n\n            if (!isTargetInsideRichTextEditor && !isTargetInsideRichTextEditorToolbar && !isTargetInsideModal) {\n                collapseEverything();\n            }\n        };\n\n        document.addEventListener('pointerdown', handleInteractWithOutside);\n        document.addEventListener('focusin', handleInteractWithOutside);\n        return () => {\n            document.removeEventListener('focusin', handleInteractWithOutside);\n            document.removeEventListener('pointerdown', handleInteractWithOutside);\n        };\n    }, [collapseEverything, collapseFloatingModals, editorRef.id]);\n\n    return null;\n};\n"],"names":["BlurObserver","hideExternalFloatingModals","editorRef","useEditorRef","isFloatingLinkModalOpen","useFloatingLinkSelectors","collapseFloatingModals","useCallback","floatingLinkActions","collapseEverything","useEffect","handleInteractWithOutside","event","richTextEditorSelector","toolbarSelector","modalSelector","richTextEditorWrapper","toolbarWrapper","modalWrapper","targetElement","isTargetInsideModal","isTargetInsideRichTextEditor","isTargetInsideRichTextEditorToolbar"],"mappings":";;AAKO,MAAMA,IAAe,CAAC;AAAA,EACzB,4BAAAC;AACJ,MAEM;AACF,QAAMC,IAAYC,KACZC,IAA0BC,EAA2B,EAAA,OAAOH,EAAU,EAAE,GAExEI,IAAyBC,EAAY,MAAM;AAC7C,IAAIH,KACAI,EAAoB,MAAM,GAE1BP,KACAA,EAA2BC,EAAU,EAAE;AAAA,EAE5C,GAAA,CAACE,GAAyBH,GAA4BC,CAAS,CAAC,GAE7DO,IAAqBF,EAAY,MAAM;AACzC,IAAAL,EAAU,SAAS,GACII;EAAA,GACxB,CAACJ,GAAWI,CAAsB,CAAC;AAEtC,SAAAI,EAAU,MAAM;AACN,UAAAC,IAA4B,CAACC,MAAmC;AAC5D,YAAAC,IAAyB,oBAAoBX,EAAU,QACvDY,IAAkB,sCAClBC,IAAgB,sBAChBC,IAAwB,SAAS,cAA8BH,CAAsB,GACrFI,IAAiB,SAAS,cAA8BH,CAAe,GACvEI,IAAe,SAAS,cAA8BH,CAAa,GACnEI,IAAgBP,EAAM,QAEtBQ,IAAsBF,KAAA,gBAAAA,EAAc,SAASC,IAC7CE,IAA+BL,KAAA,gBAAAA,EAAuB,SAASG,IAC/DG,IAAsCL,KAAA,gBAAAA,EAAgB,SAASE;AAErE,MAAIG,KACuBhB,KAGvB,CAACe,KAAgC,CAACC,KAAuC,CAACF,KACvDX;IACvB;AAGK,oBAAA,iBAAiB,eAAeE,CAAyB,GACzD,SAAA,iBAAiB,WAAWA,CAAyB,GACvD,MAAM;AACA,eAAA,oBAAoB,WAAWA,CAAyB,GACxD,SAAA,oBAAoB,eAAeA,CAAyB;AAAA,IAAA;AAAA,KAE1E,CAACF,GAAoBH,GAAwBJ,EAAU,EAAE,CAAC,GAEtD;AACX;"}