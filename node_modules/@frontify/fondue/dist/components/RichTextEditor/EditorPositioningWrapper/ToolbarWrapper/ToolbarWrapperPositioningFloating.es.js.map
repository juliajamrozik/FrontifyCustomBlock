{"version":3,"file":"ToolbarWrapperPositioningFloating.es.js","sources":["../../../../../src/components/RichTextEditor/EditorPositioningWrapper/ToolbarWrapper/ToolbarWrapperPositioningFloating.tsx"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { BalloonToolbar, ReferenceType, autoUpdate, flip, shift } from '@udecode/plate';\nimport { OFFSET_IN_PX, calculateToolbarWidth } from '@components/RichTextEditor/utils';\nimport { ToolbarWrapperProps } from './types';\n\nexport const ToolbarWrapperPositioningFloating = ({\n    children,\n    editorWidth,\n    toolbarButtonGroups = [],\n    toolbarWidth,\n}: ToolbarWrapperProps) => {\n    const [width, setWidth] = useState<number | undefined>();\n    const cleanupFunction = useRef<() => void | undefined>();\n\n    useEffect(() => {\n        if (toolbarWidth) {\n            setWidth(toolbarWidth);\n        } else {\n            const toolbarWidthSum = calculateToolbarWidth(toolbarButtonGroups);\n            if (toolbarWidthSum > 0) {\n                setWidth(toolbarWidthSum + toolbarButtonGroups.length + OFFSET_IN_PX);\n            }\n        }\n    }, [editorWidth, toolbarWidth, toolbarButtonGroups]);\n\n    useEffect(() => {\n        const handleSelectionChange = () => {\n            const selection = window.getSelection();\n            const rangeCount = selection?.rangeCount ?? 0;\n\n            const selectionFrom = rangeCount > 0 && selection?.getRangeAt(0).startOffset;\n            const selectionTo = rangeCount > 0 && selection?.getRangeAt(0).endOffset;\n            const hasActiveSelection = !!selection && selectionFrom !== selectionTo && rangeCount > 0;\n\n            if (!hasActiveSelection && cleanupFunction.current) {\n                cleanupFunction.current();\n            }\n        };\n\n        document.addEventListener('selectionchange', handleSelectionChange);\n        return () => document.removeEventListener('selectionchange', handleSelectionChange);\n    }, []);\n\n    const autoUpdateWithCleanup = (reference: ReferenceType, floating: HTMLElement, update: () => void) => {\n        cleanupFunction.current = autoUpdate(reference, floating, update);\n    };\n\n    return (\n        <BalloonToolbar\n            floatingOptions={{\n                middleware: [flip(), shift()],\n                whileElementsMounted: autoUpdateWithCleanup,\n            }}\n            styles={{ root: { border: 'none', background: '#ffffff', width, transitionDuration: '0s' } }}\n        >\n            <div\n                data-selector=\"toolbar-floating\"\n                data-test-id=\"toolbar-floating\"\n                className=\"tw-rounded tw-min-h-12 tw-border tw-border-line tw-shadow-lg tw-bg-base tw-divide-y tw-divide-line tw-flex tw-flex-wrap\"\n            >\n                {children}\n            </div>\n        </BalloonToolbar>\n    );\n};\n"],"names":["ToolbarWrapperPositioningFloating","children","editorWidth","toolbarButtonGroups","toolbarWidth","width","setWidth","useState","cleanupFunction","useRef","useEffect","toolbarWidthSum","calculateToolbarWidth","OFFSET_IN_PX","handleSelectionChange","selection","rangeCount","selectionFrom","selectionTo","autoUpdateWithCleanup","reference","floating","update","autoUpdate","React","BalloonToolbar","flip","shift"],"mappings":";;;;AAOO,MAAMA,IAAoC,CAAC;AAAA,EAC9C,UAAAC;AAAA,EACA,aAAAC;AAAA,EACA,qBAAAC,IAAsB,CAAC;AAAA,EACvB,cAAAC;AACJ,MAA2B;AACvB,QAAM,CAACC,GAAOC,CAAQ,IAAIC,EAA6B,GACjDC,IAAkBC;AAExB,EAAAC,EAAU,MAAM;AACZ,QAAIN;AACA,MAAAE,EAASF,CAAY;AAAA,SAClB;AACG,YAAAO,IAAkBC,EAAsBT,CAAmB;AACjE,MAAIQ,IAAkB,KACTL,EAAAK,IAAkBR,EAAoB,SAASU,CAAY;AAAA,IAE5E;AAAA,EACD,GAAA,CAACX,GAAaE,GAAcD,CAAmB,CAAC,GAEnDO,EAAU,MAAM;AACZ,UAAMI,IAAwB,MAAM;AAC1B,YAAAC,IAAY,OAAO,gBACnBC,KAAaD,KAAA,gBAAAA,EAAW,eAAc,GAEtCE,IAAgBD,IAAa,MAAKD,KAAA,gBAAAA,EAAW,WAAW,GAAG,cAC3DG,IAAcF,IAAa,MAAKD,KAAA,gBAAAA,EAAW,WAAW,GAAG;AAG3D,MAAA,EAFuB,CAAC,CAACA,KAAaE,MAAkBC,KAAeF,IAAa,MAE7DR,EAAgB,WACvCA,EAAgB,QAAQ;AAAA,IAC5B;AAGK,oBAAA,iBAAiB,mBAAmBM,CAAqB,GAC3D,MAAM,SAAS,oBAAoB,mBAAmBA,CAAqB;AAAA,EACtF,GAAG,CAAE,CAAA;AAEL,QAAMK,IAAwB,CAACC,GAA0BC,GAAuBC,MAAuB;AACnG,IAAAd,EAAgB,UAAUe,EAAWH,GAAWC,GAAUC,CAAM;AAAA,EAAA;AAIhE,SAAA,gBAAAE,EAAA;AAAA,IAACC;AAAA,IAAA;AAAA,MACG,iBAAiB;AAAA,QACb,YAAY,CAACC,KAAQC,GAAO;AAAA,QAC5B,sBAAsBR;AAAA,MAC1B;AAAA,MACA,QAAQ,EAAE,MAAM,EAAE,QAAQ,QAAQ,YAAY,WAAW,OAAAd,GAAO,oBAAoB,OAAO;AAAA,IAAA;AAAA,IAE3F,gBAAAmB,EAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACG,iBAAc;AAAA,QACd,gBAAa;AAAA,QACb,WAAU;AAAA,MAAA;AAAA,MAETvB;AAAA,IACL;AAAA,EAAA;AAGZ;"}