{"version":3,"file":"useTextStyleDropdown.es.js","sources":["../../../../../../src/components/RichTextEditor/Plugins/TextStylePlugin/TextStyleDropdown/useTextStyleDropdown.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { PlateEditor, usePlateEditorState } from '@udecode/plate';\nimport { Dispatch, HTMLAttributes, SetStateAction, useCallback, useEffect, useState } from 'react';\nimport { usePopper } from 'react-popper';\nimport { useSelectedTextStyles } from './useSelectedTextStyles';\nimport { verticalPositionModifier } from './verticalPositionModifier';\nimport { DEFAULT_TEXT_STYLE_VALUE } from '../types';\n\ntype UseTextStyleDropdownReturn<T, P> = {\n    state: { isOpen: boolean; toggle: () => void; editor: PlateEditor };\n    key: string;\n    dropdownProps: HTMLAttributes<P>;\n    triggerRef: Dispatch<SetStateAction<T | null>>;\n    dropdownRef: Dispatch<SetStateAction<P | null>>;\n};\n\nexport const useTextStyleDropdown = <T extends HTMLElement, P extends HTMLElement>(\n    editorId?: string,\n): UseTextStyleDropdownReturn<T, P> => {\n    const [isOpen, setIsOpen] = useState(false);\n    const [triggerElement, setTriggerElement] = useState<T | null>(null);\n    const [popperElement, setPopperElement] = useState<P | null>(null);\n    const editor = usePlateEditorState(editorId);\n    const selectedTextStyles = useSelectedTextStyles(editor);\n\n    let key = DEFAULT_TEXT_STYLE_VALUE;\n    if (selectedTextStyles.length === 1) {\n        key = selectedTextStyles[0];\n    } else if (selectedTextStyles.length === 0) {\n        key = 'p';\n    }\n\n    const toggle = useCallback(() => {\n        setIsOpen((open) => !open);\n    }, [setIsOpen]);\n\n    const popperInstance = usePopper<'offset' | 'flip' | 'vertical-positioning'>(triggerElement, popperElement, {\n        placement: 'bottom-start',\n        strategy: 'fixed',\n        modifiers: [\n            {\n                name: 'offset',\n                options: {\n                    offset: [0, 6],\n                },\n            },\n            {\n                name: 'flip',\n                enabled: false,\n            },\n            verticalPositionModifier,\n        ],\n    });\n\n    useEffect(() => {\n        const listener = (event: Event) => {\n            if (isOpen) {\n                const target = event.target as HTMLElement;\n                if (popperElement && popperElement.contains(target)) {\n                    return;\n                }\n                if (triggerElement && triggerElement.contains(target)) {\n                    return;\n                }\n\n                setIsOpen(false);\n            }\n        };\n        document.addEventListener('pointerdown', listener);\n        return () => {\n            document.removeEventListener('pointerdown', listener);\n        };\n    }, [isOpen, popperElement, setIsOpen, triggerElement]);\n\n    return {\n        state: { isOpen, toggle, editor },\n        dropdownProps: {\n            ...popperInstance.attributes.popper,\n            style: popperInstance.styles.popper,\n        },\n        key,\n        dropdownRef: setPopperElement,\n        triggerRef: setTriggerElement,\n    };\n};\n"],"names":["useTextStyleDropdown","editorId","isOpen","setIsOpen","useState","triggerElement","setTriggerElement","popperElement","setPopperElement","editor","usePlateEditorState","selectedTextStyles","useSelectedTextStyles","key","DEFAULT_TEXT_STYLE_VALUE","toggle","useCallback","open","popperInstance","usePopper","verticalPositionModifier","useEffect","listener","event","target"],"mappings":";;;;;;AAiBa,MAAAA,IAAuB,CAChCC,MACmC;AACnC,QAAM,CAACC,GAAQC,CAAS,IAAIC,EAAS,EAAK,GACpC,CAACC,GAAgBC,CAAiB,IAAIF,EAAmB,IAAI,GAC7D,CAACG,GAAeC,CAAgB,IAAIJ,EAAmB,IAAI,GAC3DK,IAASC,EAAoBT,CAAQ,GACrCU,IAAqBC,EAAsBH,CAAM;AAEvD,MAAII,IAAMC;AACN,EAAAH,EAAmB,WAAW,IAC9BE,IAAMF,EAAmB,CAAC,IACnBA,EAAmB,WAAW,MAC/BE,IAAA;AAGJ,QAAAE,IAASC,EAAY,MAAM;AACnB,IAAAb,EAAA,CAACc,MAAS,CAACA,CAAI;AAAA,EAAA,GAC1B,CAACd,CAAS,CAAC,GAERe,IAAiBC,EAAsDd,GAAgBE,GAAe;AAAA,IACxG,WAAW;AAAA,IACX,UAAU;AAAA,IACV,WAAW;AAAA,MACP;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,UACL,QAAQ,CAAC,GAAG,CAAC;AAAA,QACjB;AAAA,MACJ;AAAA,MACA;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,MACb;AAAA,MACAa;AAAA,IACJ;AAAA,EAAA,CACH;AAED,SAAAC,EAAU,MAAM;AACN,UAAAC,IAAW,CAACC,MAAiB;AAC/B,UAAIrB,GAAQ;AACR,cAAMsB,IAASD,EAAM;AAIrB,YAHIhB,KAAiBA,EAAc,SAASiB,CAAM,KAG9CnB,KAAkBA,EAAe,SAASmB,CAAM;AAChD;AAGJ,QAAArB,EAAU,EAAK;AAAA,MACnB;AAAA,IAAA;AAEK,oBAAA,iBAAiB,eAAemB,CAAQ,GAC1C,MAAM;AACA,eAAA,oBAAoB,eAAeA,CAAQ;AAAA,IAAA;AAAA,KAEzD,CAACpB,GAAQK,GAAeJ,GAAWE,CAAc,CAAC,GAE9C;AAAA,IACH,OAAO,EAAE,QAAAH,GAAQ,QAAAa,GAAQ,QAAAN,EAAO;AAAA,IAChC,eAAe;AAAA,MACX,GAAGS,EAAe,WAAW;AAAA,MAC7B,OAAOA,EAAe,OAAO;AAAA,IACjC;AAAA,IACA,KAAAL;AAAA,IACA,aAAaL;AAAA,IACb,YAAYF;AAAA,EAAA;AAEpB;"}