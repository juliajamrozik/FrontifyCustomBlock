{"version":3,"file":"useFloatingLinkEdit.es.js","sources":["../../../../../../../src/components/RichTextEditor/Plugins/LinkPlugin/FloatingLink/EditLinkModal/useFloatingLinkEdit.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { useCallback, useEffect } from 'react';\nimport {\n    ELEMENT_LINK,\n    FloatingLinkProps,\n    HTMLPropsAs,\n    LinkPlugin,\n    floatingLinkActions,\n    floatingLinkSelectors,\n    getAboveNode,\n    getDefaultBoundingClientRect,\n    getEndPoint,\n    getPluginOptions,\n    getPluginType,\n    getRangeBoundingClientRect,\n    getStartPoint,\n    someNode,\n    triggerFloatingLinkEdit,\n    useComposedRef,\n    useEditorRef,\n    useFloatingLinkEnter,\n    useFloatingLinkEscape,\n    useFloatingLinkSelectors,\n    useHotkeys,\n    usePlateSelectors,\n    useVirtualFloatingLink,\n} from '@udecode/plate';\nimport { getUrlFromEditor } from '../../utils';\n\nexport const useFloatingLinkEdit = ({ floatingOptions, ...props }: FloatingLinkProps): HTMLPropsAs<'div'> => {\n    const editor = useEditorRef();\n    const keyEditor = usePlateSelectors().keyEditor();\n    const mode = useFloatingLinkSelectors().mode();\n    const open = useFloatingLinkSelectors().isOpen(editor.id);\n\n    const { triggerFloatingLinkHotkeys = 'command+k, ctrl+k' } = getPluginOptions<LinkPlugin>(editor, ELEMENT_LINK);\n\n    const getBoundingClientRect = useCallback(() => {\n        const entry = getAboveNode(editor, {\n            match: { type: getPluginType(editor, ELEMENT_LINK) },\n        });\n\n        if (entry) {\n            const [, path] = entry;\n            return getRangeBoundingClientRect(editor, {\n                anchor: getStartPoint(editor, path),\n                focus: getEndPoint(editor, path),\n            });\n        }\n\n        return getDefaultBoundingClientRect();\n    }, [editor]);\n\n    const isOpen = open && mode === 'edit';\n\n    const { update, style, floating } = useVirtualFloatingLink({\n        editorId: editor.id,\n        open: isOpen,\n        getBoundingClientRect,\n        ...floatingOptions,\n    });\n\n    useEffect(() => {\n        const url = getUrlFromEditor(editor);\n        if (url) {\n            floatingLinkActions.url(url);\n        }\n\n        if (\n            editor.selection &&\n            someNode(editor, {\n                match: { type: getPluginType(editor, ELEMENT_LINK) },\n            })\n        ) {\n            floatingLinkActions.show('edit', editor.id);\n            update();\n            return;\n        }\n\n        if (floatingLinkSelectors.mode() === 'edit') {\n            floatingLinkActions.hide();\n        }\n    }, [editor, keyEditor, update]);\n\n    useHotkeys(\n        triggerFloatingLinkHotkeys,\n        (e) => {\n            e.preventDefault();\n\n            if (floatingLinkSelectors.mode() === 'edit') {\n                triggerFloatingLinkEdit(editor);\n            }\n        },\n        {\n            enableOnContentEditable: true,\n        },\n        [],\n    );\n\n    useFloatingLinkEnter();\n\n    useFloatingLinkEscape();\n\n    return {\n        style: {\n            ...style,\n            zIndex: 1,\n        },\n        ...props,\n        ref: useComposedRef<HTMLElement | null>(props.ref, floating),\n    };\n};\n"],"names":["useFloatingLinkEdit","floatingOptions","props","editor","useEditorRef","keyEditor","usePlateSelectors","mode","useFloatingLinkSelectors","open","triggerFloatingLinkHotkeys","getPluginOptions","ELEMENT_LINK","getBoundingClientRect","useCallback","entry","getAboveNode","getPluginType","path","getRangeBoundingClientRect","getStartPoint","getEndPoint","getDefaultBoundingClientRect","isOpen","update","style","floating","useVirtualFloatingLink","useEffect","url","getUrlFromEditor","floatingLinkActions","someNode","floatingLinkSelectors","useHotkeys","triggerFloatingLinkEdit","useFloatingLinkEnter","useFloatingLinkEscape","useComposedRef"],"mappings":";;;AA8BO,MAAMA,IAAsB,CAAC,EAAE,iBAAAC,GAAiB,GAAGC,QAAmD;AACzG,QAAMC,IAASC,KACTC,IAAYC,IAAoB,aAChCC,IAAOC,IAA2B,QAClCC,IAAOD,EAA2B,EAAA,OAAOL,EAAO,EAAE,GAElD,EAAE,4BAAAO,IAA6B,oBAAA,IAAwBC,EAA6BR,GAAQS,CAAY,GAExGC,IAAwBC,EAAY,MAAM;AACtC,UAAAC,IAAQC,EAAab,GAAQ;AAAA,MAC/B,OAAO,EAAE,MAAMc,EAAcd,GAAQS,CAAY,EAAE;AAAA,IAAA,CACtD;AAED,QAAIG,GAAO;AACD,YAAA,CAAG,EAAAG,CAAI,IAAIH;AACjB,aAAOI,EAA2BhB,GAAQ;AAAA,QACtC,QAAQiB,EAAcjB,GAAQe,CAAI;AAAA,QAClC,OAAOG,EAAYlB,GAAQe,CAAI;AAAA,MAAA,CAClC;AAAA,IACL;AAEA,WAAOI,EAA6B;AAAA,EAAA,GACrC,CAACnB,CAAM,CAAC,GAELoB,IAASd,KAAQF,MAAS,QAE1B,EAAE,QAAAiB,GAAQ,OAAAC,GAAO,UAAAC,EAAA,IAAaC,EAAuB;AAAA,IACvD,UAAUxB,EAAO;AAAA,IACjB,MAAMoB;AAAA,IACN,uBAAAV;AAAA,IACA,GAAGZ;AAAA,EAAA,CACN;AAED,SAAA2B,EAAU,MAAM;AACN,UAAAC,IAAMC,EAAiB3B,CAAM;AAM/B,QALA0B,KACAE,EAAoB,IAAIF,CAAG,GAI3B1B,EAAO,aACP6B,EAAS7B,GAAQ;AAAA,MACb,OAAO,EAAE,MAAMc,EAAcd,GAAQS,CAAY,EAAE;AAAA,IAAA,CACtD,GACH;AACsB,MAAAmB,EAAA,KAAK,QAAQ5B,EAAO,EAAE,GACnCqB;AACP;AAAA,IACJ;AAEI,IAAAS,EAAsB,KAAK,MAAM,UACjCF,EAAoB,KAAK;AAAA,EAE9B,GAAA,CAAC5B,GAAQE,GAAWmB,CAAM,CAAC,GAE9BU;AAAA,IACIxB;AAAA,IACA,CAAC,MAAM;AACH,QAAE,eAAe,GAEbuB,EAAsB,KAAK,MAAM,UACjCE,EAAwBhC,CAAM;AAAA,IAEtC;AAAA,IACA;AAAA,MACI,yBAAyB;AAAA,IAC7B;AAAA,IACA,CAAC;AAAA,EAAA,GAGgBiC,KAECC,KAEf;AAAA,IACH,OAAO;AAAA,MACH,GAAGZ;AAAA,MACH,QAAQ;AAAA,IACZ;AAAA,IACA,GAAGvB;AAAA,IACH,KAAKoC,EAAmCpC,EAAM,KAAKwB,CAAQ;AAAA,EAAA;AAEnE;"}