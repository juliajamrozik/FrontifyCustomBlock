{"version":3,"file":"useBlockSettings.es.js","sources":["../../src/react/useBlockSettings.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { useEffect, useState } from 'react';\n\nimport { mergeDeep } from '../utilities/object';\nimport type { AppBridgeBlock } from '../AppBridgeBlock';\n\nexport type BlockSettingsUpdateEvent<T = Record<string, unknown>> = {\n    blockId: number;\n    blockSettings: T;\n};\n\nexport const useBlockSettings = <T = Record<string, unknown>>(\n    appBridge: AppBridgeBlock,\n): [T, (newSettings: Partial<T>) => Promise<void>] => {\n    const blockId = appBridge.getBlockId();\n    const [blockSettings, setBlockSettings] = useState<T>(structuredClone(window.blockSettings[blockId]) as T);\n\n    // Add listener for block settings updates\n    useEffect(() => {\n        const updateBlockSettingsFromEvent = (event: BlockSettingsUpdateEvent) => {\n            if (event.blockId === blockId) {\n                setBlockSettings({ ...event.blockSettings } as T);\n            }\n        };\n\n        window.emitter.on('AppBridge:BlockSettingsUpdated', updateBlockSettingsFromEvent);\n\n        return () => {\n            window.emitter.off('AppBridge:BlockSettingsUpdated', updateBlockSettingsFromEvent);\n        };\n    }, [blockId]);\n\n    const updateBlockSettings = async (blockSettingsUpdate: Partial<T>) => {\n        try {\n            await appBridge.updateBlockSettings(blockSettingsUpdate);\n            window.emitter.emit('AppBridge:BlockSettingsUpdated', {\n                blockId,\n                blockSettings: mergeDeep(blockSettings, blockSettingsUpdate),\n            });\n        } catch (error) {\n            console.error(error);\n        }\n    };\n\n    return [blockSettings, updateBlockSettings];\n};\n"],"names":["useBlockSettings","appBridge","blockId","blockSettings","setBlockSettings","useState","useEffect","updateBlockSettingsFromEvent","event","blockSettingsUpdate","mergeDeep","error"],"mappings":";;AAYa,MAAAA,IAAmB,CAC5BC,MACkD;AAC5C,QAAAC,IAAUD,EAAU,cACpB,CAACE,GAAeC,CAAgB,IAAIC,EAAY,gBAAgB,OAAO,cAAcH,CAAO,CAAC,CAAM;AAGzG,SAAAI,EAAU,MAAM;AACN,UAAAC,IAA+B,CAACC,MAAoC;AAClE,MAAAA,EAAM,YAAYN,KAClBE,EAAiB,EAAE,GAAGI,EAAM,cAAoB,CAAA;AAAA,IACpD;AAGG,kBAAA,QAAQ,GAAG,kCAAkCD,CAA4B,GAEzE,MAAM;AACF,aAAA,QAAQ,IAAI,kCAAkCA,CAA4B;AAAA,IAAA;AAAA,EACrF,GACD,CAACL,CAAO,CAAC,GAcL,CAACC,GAZoB,OAAOM,MAAoC;AAC/D,QAAA;AACM,YAAAR,EAAU,oBAAoBQ,CAAmB,GAChD,OAAA,QAAQ,KAAK,kCAAkC;AAAA,QAClD,SAAAP;AAAA,QACA,eAAeQ,EAAUP,GAAeM,CAAmB;AAAA,MAAA,CAC9D;AAAA,aACIE,GAAO;AACZ,cAAQ,MAAMA,CAAK;AAAA,IACvB;AAAA,EAAA,CAGsC;AAC9C;"}