{"version":3,"file":"useAssetUpload.es.js","sources":["../../src/react/useAssetUpload.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { useRef, useState } from 'react';\n\nimport type { Asset, FileApi } from '../types';\nimport { useFileUpload } from './useFileUpload';\nimport { createAssetByFileId } from '../repositories/AssetRepository';\n\nexport type UseAssetUploadParameters = {\n    onUploadProgress?: (event: MessageEvent) => void;\n    onUploadProgressAll?: (event: MessageEvent) => void;\n    onUploadDone?: (event: MessageEvent<FileApi>) => void;\n    onUploadDoneAll?: (event: Asset[]) => void;\n    onUploadFail?: () => void;\n    onUploadAssetFail?: (event: MessageEvent) => void;\n};\n\nexport type UseAssetUploadReturnTypes = [(files: FileList | File) => void, { results: Asset[]; doneAll: boolean }];\n\nexport const useAssetUpload = (props?: UseAssetUploadParameters): UseAssetUploadReturnTypes => {\n    const results = useRef<Asset[]>([]);\n    const promises = useRef<Promise<unknown>[]>([]);\n    const [doneAll, setDoneAll] = useState(false);\n\n    const { onUploadProgress, onUploadProgressAll, onUploadDone, onUploadDoneAll, onUploadFail, onUploadAssetFail } =\n        props ?? {};\n\n    const projectId = window.application?.sandbox?.config?.context?.project?.id;\n\n    const onProgress = (workerEvent: MessageEvent<FileApi>) => {\n        onUploadProgress?.(workerEvent);\n    };\n\n    const onProgressAll = (workerEvent: MessageEvent<FileApi>) => {\n        onUploadProgressAll?.(workerEvent);\n    };\n\n    const onDone = async (workerEvent: MessageEvent<FileApi>) => {\n        const assetPromise = createAssetFromFileIds(workerEvent.data.file_id);\n        promises.current.push(assetPromise);\n\n        onUploadDone?.(workerEvent);\n\n        results.current = [...results.current, await assetPromise];\n    };\n\n    const onDoneAll = async () => {\n        await Promise.all(promises.current);\n\n        onUploadDoneAll?.(results.current);\n\n        setDoneAll(true);\n    };\n\n    const onFail = () => {\n        onUploadFail?.();\n    };\n\n    const onFileFail = (workerEvent: MessageEvent<FileApi>) => {\n        onUploadAssetFail?.(workerEvent);\n    };\n\n    const resetState = () => {\n        setDoneAll(false);\n        results.current = [];\n    };\n\n    const createAssetFromFileIds = async (fileId: string) => {\n        return await createAssetByFileId(fileId, projectId);\n    };\n\n    const [uploadFilesInternal] = useFileUpload({\n        onUploadProgress: onProgress,\n        onUploadProgressAll: onProgressAll,\n        onUploadDone: onDone,\n        onUploadDoneAll: onDoneAll,\n        onUploadFail: onFail,\n        onUploadFileFail: onFileFail,\n    });\n\n    const uploadFiles = (files: FileList | File) => {\n        resetState();\n        uploadFilesInternal(files);\n    };\n\n    return [uploadFiles, { results: results.current, doneAll }];\n};\n"],"names":["useAssetUpload","props","results","useRef","promises","doneAll","setDoneAll","useState","onUploadProgress","onUploadProgressAll","onUploadDone","onUploadDoneAll","onUploadFail","onUploadAssetFail","projectId","_e","_d","_c","_b","_a","onProgress","workerEvent","onProgressAll","onDone","assetPromise","createAssetFromFileIds","onDoneAll","onFail","onFileFail","resetState","fileId","createAssetByFileId","uploadFilesInternal","useFileUpload","files"],"mappings":";;;AAmBa,MAAAA,IAAiB,CAACC,MAAgE;;AACrF,QAAAC,IAAUC,EAAgB,CAAA,CAAE,GAC5BC,IAAWD,EAA2B,CAAA,CAAE,GACxC,CAACE,GAASC,CAAU,IAAIC,EAAS,EAAK,GAEtC,EAAE,kBAAAC,GAAkB,qBAAAC,GAAqB,cAAAC,GAAc,iBAAAC,GAAiB,cAAAC,GAAc,mBAAAC,EAAA,IACxFZ,KAAS,IAEPa,KAAYC,KAAAC,KAAAC,KAAAC,KAAAC,IAAA,OAAO,gBAAP,gBAAAA,EAAoB,YAApB,gBAAAD,EAA6B,WAA7B,gBAAAD,EAAqC,YAArC,gBAAAD,EAA8C,YAA9C,gBAAAD,EAAuD,IAEnEK,IAAa,CAACC,MAAuC;AACvD,IAAAb,KAAA,QAAAA,EAAmBa;AAAA,EAAW,GAG5BC,IAAgB,CAACD,MAAuC;AAC1D,IAAAZ,KAAA,QAAAA,EAAsBY;AAAA,EAAW,GAG/BE,IAAS,OAAOF,MAAuC;AACzD,UAAMG,IAAeC,EAAuBJ,EAAY,KAAK,OAAO;AAC3D,IAAAjB,EAAA,QAAQ,KAAKoB,CAAY,GAElCd,KAAA,QAAAA,EAAeW,IAEfnB,EAAQ,UAAU,CAAC,GAAGA,EAAQ,SAAS,MAAMsB,CAAY;AAAA,EAAA,GAGvDE,IAAY,YAAY;AACpB,UAAA,QAAQ,IAAItB,EAAS,OAAO,GAElCO,KAAA,QAAAA,EAAkBT,EAAQ,UAE1BI,EAAW,EAAI;AAAA,EAAA,GAGbqB,IAAS,MAAM;AACF,IAAAf,KAAA,QAAAA;AAAA,EAAA,GAGbgB,IAAa,CAACP,MAAuC;AACvD,IAAAR,KAAA,QAAAA,EAAoBQ;AAAA,EAAW,GAG7BQ,IAAa,MAAM;AACrB,IAAAvB,EAAW,EAAK,GAChBJ,EAAQ,UAAU;EAAC,GAGjBuB,IAAyB,OAAOK,MAC3B,MAAMC,EAAoBD,GAAQhB,CAAS,GAGhD,CAACkB,CAAmB,IAAIC,EAAc;AAAA,IACxC,kBAAkBb;AAAA,IAClB,qBAAqBE;AAAA,IACrB,cAAcC;AAAA,IACd,iBAAiBG;AAAA,IACjB,cAAcC;AAAA,IACd,kBAAkBC;AAAA,EAAA,CACrB;AAOD,SAAO,CALa,CAACM,MAA2B;AACjC,IAAAL,KACXG,EAAoBE,CAAK;AAAA,EAAA,GAGR,EAAE,SAAShC,EAAQ,SAAS,SAAAG,GAAS;AAC9D;"}