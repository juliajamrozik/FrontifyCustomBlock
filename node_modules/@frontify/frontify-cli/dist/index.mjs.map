{"version":3,"file":"index.mjs","sources":["../src/utils/compiler.ts","../src/utils/configuration.ts","../src/utils/date.ts","../src/utils/logger.ts","../src/errors/FileNotFoundError.ts","../src/utils/file.ts","../src/errors/HttpClientError.ts","../src/utils/httpClient.ts","../src/errors/ParseJsonError.ts","../src/utils/reactiveJson.ts","../src/utils/npm.ts","../src/errors/CommandExecutionError.ts","../src/utils/promiseExec.ts","../src/errors/InvalidInstanceUrlError.ts","../src/utils/url.ts","../src/utils/user.ts","../src/commands/createContentBlock.ts","../src/commands/deploy.ts","../src/commands/login.ts","../src/commands/logout.ts","../src/commands/serve.ts","../src/index.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport react from '@vitejs/plugin-react';\nimport { build } from 'vite';\nimport { viteExternalsPlugin } from 'vite-plugin-externals';\n\nexport const compile = async (projectPath: string, entryFile: string, outputName: string) =>\n    build({\n        plugins: [\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            //@ts-ignore\n            react(),\n            viteExternalsPlugin({\n                react: 'React',\n                'react-dom': 'ReactDOM',\n            }),\n        ],\n        define: {\n            'process.env.NODE_ENV': JSON.stringify('production'),\n        },\n        root: projectPath,\n        build: {\n            lib: {\n                name: outputName,\n                entry: entryFile,\n                formats: ['iife'],\n                fileName: () => 'index.js',\n            },\n            rollupOptions: {\n                external: ['react', 'react-dom'],\n                output: {\n                    globals: {\n                        react: 'React',\n                        'react-dom': 'ReactDOM',\n                    },\n                    footer: `window.${outputName} = ${outputName};`,\n                },\n            },\n        },\n    });\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport Conf from 'conf';\n\nexport class Configuration {\n    private static readonly conf = new Conf<Record<string, string | undefined>>({\n        projectName: 'frontify-cli',\n    });\n\n    static set(key: string, value: unknown): void {\n        this.conf.set(key, value);\n    }\n\n    static get(key: string): string | undefined {\n        return this.conf.get(key, undefined);\n    }\n\n    static delete(key: string): void {\n        return this.conf.delete(key);\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nexport const getCurrentTime = (): string => {\n    const now = new Date();\n    return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(\n        now.getSeconds(),\n    ).padStart(2, '0')}`;\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport pc from 'picocolors';\nimport { getCurrentTime } from './date.js';\n\nexport class Logger {\n    static defaultInfo(...messages: string[]): void {\n        console.log(Logger.spacer(10), ...messages);\n    }\n\n    static info(...messages: string[]): void {\n        console.log(`[${getCurrentTime()}] ${messages.join(' ')}`);\n    }\n\n    static success(...messages: string[]): void {\n        console.log(`[${getCurrentTime()}] ${pc.green(messages.join(' '))}`);\n    }\n\n    static error(...messages: string[]): void {\n        console.error(pc.red(`[${getCurrentTime()}] ${messages.join(' ')}`));\n    }\n\n    static spacer(width = 1): string {\n        return Array(width + 1).join(' ');\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { Logger } from '../utils/logger.js';\n\nexport default class FileNotFoundError extends Error {\n    readonly name = 'FileNotFoundError';\n    constructor(path: string) {\n        super();\n        Logger.error(`The file at \"${path}\" was not found.`);\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { copyFileSync, mkdirSync, readFileSync, readdirSync, statSync } from 'node:fs';\nimport { resolve } from 'node:path';\nimport globToRegExp from 'glob-to-regexp';\nimport FileNotFoundError from '../errors/FileNotFoundError.js';\n\nexport const isDirectoryEmpty = (folderPath: string): boolean => {\n    try {\n        return readdirSync(folderPath).length === 0;\n    } catch {\n        return true;\n    }\n};\n\nexport const copyFolder = (\n    sourceFolderPath: string,\n    destinationFolderPath: string,\n    options?: { exclude: string[] },\n) => {\n    mkdirSync(destinationFolderPath, { recursive: true });\n    const excludePatterns = options?.exclude.map((glob) => globToRegExp(glob));\n\n    for (const file of readdirSync(sourceFolderPath)) {\n        if (excludePatterns !== undefined && excludePatterns.some((re) => re.test(file))) {\n            continue;\n        }\n        const srcFile = resolve(sourceFolderPath, file);\n        const destFile = resolve(destinationFolderPath, file);\n        copyFile(srcFile, destFile);\n    }\n};\n\nexport const copyFile = (sourceFilePath: string, destinationFilePath: string) => {\n    const stat = statSync(sourceFilePath);\n    if (stat.isDirectory()) {\n        copyFolder(sourceFilePath, destinationFilePath);\n    } else {\n        copyFileSync(sourceFilePath, destinationFilePath);\n    }\n};\n\nexport const readFile = (filePath: string): string => {\n    try {\n        return readFileSync(filePath, 'utf-8');\n    } catch {\n        throw new FileNotFoundError(filePath);\n    }\n};\n\nexport const readFileAsBase64 = (filePath: string): string => {\n    try {\n        return readFileSync(filePath, 'base64');\n    } catch {\n        throw new FileNotFoundError(filePath);\n    }\n};\n\nexport const readFileLinesAsArray = (filePath: string): string[] => {\n    try {\n        const content = readFile(filePath);\n        return content.split(/\\r?\\n/).filter((line) => line !== '');\n    } catch {\n        throw new FileNotFoundError(filePath);\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nexport class HttpClientError extends Error {\n    public code = 0;\n    public responseBody: { sucess: false; error: string };\n\n    constructor(code: number, responseBody: { sucess: false; error: string }) {\n        super(`Status code ${code}`);\n        this.name = 'HttpClientError';\n        this.code = code;\n        this.responseBody = responseBody;\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport fetch from 'node-fetch';\nimport { HttpClientError } from '../errors/HttpClientError.js';\n\ninterface RequestOptions {\n    headers?: {\n        Authorization?: string;\n    };\n}\n\ninterface FetchParameters {\n    method: 'GET' | 'POST' | 'PUT' | 'DELETE';\n    url: string;\n    body?: Record<string, unknown>;\n    options?: RequestOptions;\n}\n\nexport class HttpClient {\n    private readonly baseUrl: string;\n\n    constructor(baseUrl: string) {\n        this.baseUrl = baseUrl.replace(/^https?:\\/\\//, '');\n    }\n\n    private async fetchExtended<T>({ method, url, body, options }: FetchParameters): Promise<T> {\n        const response = await fetch(this.getAbsoluteUrl(url), {\n            method,\n            ...(body && {\n                body: JSON.stringify(body),\n            }),\n            ...options,\n            headers: { 'Content-Type': 'application/json', ...options?.headers },\n        });\n\n        if (response.status === 200) {\n            const contentType = response.headers.get('Content-Type');\n\n            switch (contentType) {\n                case 'application/json':\n                    const responseJson = await response.json();\n                    if (!responseJson) {\n                        return undefined as T;\n                    }\n                    return responseJson as T;\n                default:\n                    const responseText = await response.text();\n                    if (!responseText) {\n                        return undefined as T;\n                    }\n                    return responseText as T;\n            }\n        } else {\n            const errorData = (await response.json()) as { sucess: false; error: string };\n            throw new HttpClientError(response.status, errorData);\n        }\n    }\n\n    public get<T>(url: string, options?: RequestOptions): Promise<T> {\n        return this.fetchExtended<T>({ url, method: 'GET', options });\n    }\n\n    public post<T>(url: string, body?: Record<string, unknown>, options?: RequestOptions): Promise<T> {\n        return this.fetchExtended({ url, method: 'POST', body, options });\n    }\n\n    public put<T>(url: string, body?: Record<string, unknown>, options?: RequestOptions): Promise<T> {\n        return this.fetchExtended({ url, method: 'PUT', body, options });\n    }\n\n    public delete<T>(url: string, options?: RequestOptions): Promise<T> {\n        return this.fetchExtended({ url, method: 'DELETE', options });\n    }\n\n    private getAbsoluteUrl(relativeUrl: string): string {\n        return `https://${this.baseUrl}${relativeUrl}`;\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { Logger } from '../utils/logger.js';\n\nexport default class ParseJsonError extends Error {\n    readonly name = 'ParseJsonError';\n    constructor(path: string) {\n        super();\n        Logger.error(`The file at \"${path}\" could not be parsed.`);\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { readFileSync, writeFileSync } from 'node:fs';\nimport ParseJsonError from '../errors/ParseJsonError.js';\nimport FileNotFoundError from '../errors/FileNotFoundError.js';\n\nexport const reactiveJson = <T>(path: string): T => {\n    try {\n        const jsonRaw = readFileSync(path, 'utf8');\n        const jsonParsed = JSON.parse(jsonRaw);\n\n        return new Proxy(jsonParsed, {\n            set: (obj, prop, value) => {\n                obj[prop] = value;\n\n                const jsonString = JSON.stringify(obj, null, '\\t');\n\n                writeFileSync(path, jsonString);\n\n                return true;\n            },\n        });\n    } catch (error) {\n        if (error instanceof SyntaxError) {\n            throw new ParseJsonError(path);\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        } else if ((error as any).code === 'ENOENT') {\n            throw new FileNotFoundError(path);\n        }\n\n        throw new Error(error as string);\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { resolve } from 'node:path';\n\nimport { isDirectoryEmpty } from './file.js';\nimport { reactiveJson } from './reactiveJson.js';\n\ntype PackageJson = {\n    name: string;\n    version: string;\n    main: string;\n};\n\nexport const updatePackageJsonProjectName = (folderPath: string): void => {\n    const packageJsonPath = resolve(folderPath, 'package.json');\n    const packageJson = reactiveJson<PackageJson>(packageJsonPath);\n    packageJson.name = folderPath;\n};\n\nexport const isValidName = (folderName: string): true | string => {\n    if (!folderName) {\n        return 'The content block name can not be empty.';\n    } else if (!/^[_a-z-]+$/.test(folderName)) {\n        return 'The project name needs to be \"a-z\" separated by \"-\" or \"_\".';\n    } else if (!isDirectoryEmpty(folderName)) {\n        return `The directory ./${folderName} already exist.`;\n    } else {\n        return true;\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { Logger } from '../utils/logger.js';\n\nexport default class CommandExecutionError extends Error {\n    readonly name = 'CommandExecutionError';\n    constructor(error: string) {\n        super();\n        Logger.error(`The command execution failed: ${error}`);\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { ExecOptions, exec } from 'node:child_process';\nimport CommandExecutionError from '../errors/CommandExecutionError.js';\n\nexport const promiseExec = (command: string, options: ExecOptions = {}): Promise<string> => {\n    return new Promise((resolve, reject) => {\n        exec(command, options, (error, stdout) => {\n            if (error) {\n                return reject(new CommandExecutionError(error + stdout));\n            } else {\n                return resolve(stdout);\n            }\n        });\n    });\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { Logger } from '../utils/logger.js';\n\nexport default class InvalidInstanceUrlError extends Error {\n    readonly name = 'InvalidInstanceUrlError';\n    constructor(url: string) {\n        super();\n        if (url) {\n            Logger.error(`The given URL \"${url}\" is invalid.`);\n        } else {\n            Logger.error('No instance URL was given.');\n        }\n    }\n}\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { URL } from 'node:url';\nimport InvalidInstanceUrlError from '../errors/InvalidInstanceUrlError.js';\n\nexport const getValidInstanceUrl = (url: string): string => {\n    try {\n        const cleanHost = url.replace(/^https?:\\/\\//, '');\n        const parsedUrl = new URL(`https://${cleanHost}`);\n        return parsedUrl.hostname;\n    } catch {\n        throw new InvalidInstanceUrlError(url);\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport pc from 'picocolors';\nimport { HttpClient } from './httpClient.js';\nimport { Logger } from './logger.js';\nimport { Configuration } from './configuration.js';\n\nexport interface UserInfo {\n    name: string;\n    email: string;\n}\n\nexport const getUser = async (instanceUrl: string): Promise<UserInfo | undefined> => {\n    const httpClient = new HttpClient(instanceUrl);\n\n    const accessToken = Configuration.get('tokens.access_token');\n\n    try {\n        const user = await httpClient.post<{ data: { currentUser: UserInfo } }>(\n            '/graphql',\n            { query: '{ currentUser { email name } }' },\n            { headers: { Authorization: `Bearer ${accessToken}` } },\n        );\n        return user.data.currentUser;\n    } catch {\n        Logger.error(`You are not logged in, you can use the command ${pc.bold('frontify-cli login')}.`);\n        return undefined;\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { resolve } from 'node:path';\nimport { fileURLToPath } from 'node:url';\nimport pc from 'picocolors';\nimport { Logger, copyFolder, updatePackageJsonProjectName } from '../utils/index.js';\n\nconst CONTENT_BLOCK_PREFIX = 'content-block-';\n\nexport const createNewContentBlock = (contentBlockName: string, template = 'tailwind'): void => {\n    Logger.info('Creating the content block...');\n\n    const blockPathInBlue = pc.blue(`./${contentBlockName}`);\n    Logger.info(`Scaffholding content block in ${blockPathInBlue}...`);\n\n    const templateDir = resolve(fileURLToPath(import.meta.url), `../../templates/${CONTENT_BLOCK_PREFIX}${template}`);\n    copyFolder(templateDir, contentBlockName, { exclude: ['node_modules'] });\n\n    updatePackageJsonProjectName(contentBlockName);\n\n    Logger.defaultInfo(`\\n${Logger.spacer(11)}You can now access the project and install dependencies.`);\n    const blockNameInBlue = pc.blue(`./${contentBlockName}`);\n    Logger.defaultInfo(`${Logger.spacer(4)}cd ${blockNameInBlue}`);\n    Logger.defaultInfo(`${Logger.spacer(4)}npm i`);\n    Logger.defaultInfo(`${Logger.spacer(4)}npm run serve`);\n\n    Logger.defaultInfo(`\\n${Logger.spacer(11)}Happy hacking!`);\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport pc from 'picocolors';\nimport fastGlob from 'fast-glob';\nimport open from 'open';\nimport { join } from 'node:path';\n\nimport {\n    Configuration,\n    HttpClient,\n    Logger,\n    UserInfo,\n    compile,\n    getUser,\n    promiseExec,\n    reactiveJson,\n    readFileAsBase64,\n    readFileLinesAsArray,\n} from '../utils/index.js';\nimport { HttpClientError } from '../errors/HttpClientError.js';\n\ntype Options = {\n    dryRun?: boolean;\n    noVerify?: boolean;\n    openInBrowser?: boolean;\n};\n\ntype Manifest = {\n    appId: string;\n};\n\nconst makeFilesDict = async (glob: string, ignoreGlobs?: string[]) => {\n    const folderFiles = await fastGlob(join(glob, '**'), { ignore: ignoreGlobs, dot: true });\n\n    const folderFilenames = folderFiles.map((filePath) => filePath.replace(`${glob}/`, ''));\n\n    return folderFilenames.reduce((stack, filename, index) => {\n        stack[`/${filename}`] = readFileAsBase64(folderFiles[index]);\n        return stack;\n    }, {});\n};\n\nconst BUILD_FILE_BLOCK_LIST = ['**/*.*.map'];\nconst SOURCE_FILE_BLOCK_LIST = ['.git', 'node_modules', 'dist', '.vscode', '.idea', 'README.md', '.DS_Store'];\n\nexport const createDeployment = async (\n    entryFileName: string,\n    distPath: string,\n    { dryRun = false, noVerify = false, openInBrowser = false }: Options,\n): Promise<void> => {\n    try {\n        let user: UserInfo | undefined;\n        const instanceUrl = Configuration.get('instanceUrl') as string | undefined;\n        if (!instanceUrl) {\n            Logger.error(`You are not logged in, you can use the command ${pc.bold('frontify-cli login')}.`);\n            process.exit(-1);\n        }\n\n        if (!dryRun) {\n            user = await getUser(instanceUrl);\n            user && Logger.info(`You are logged in as ${user.name} (${instanceUrl}).`);\n        }\n\n        if (user || dryRun) {\n            dryRun && Logger.info(pc.blue('Dry run: enabled'));\n\n            const projectPath = process.cwd();\n            const manifest = reactiveJson<Manifest>(join(projectPath, 'manifest.json'));\n\n            if (!noVerify) {\n                Logger.info('Performing type checks...');\n                await promiseExec('npx tsc --noEmit');\n\n                Logger.info('Performing eslint checks...');\n                await promiseExec('npx eslint src');\n            }\n\n            try {\n                await compile(projectPath, entryFileName, manifest.appId);\n            } catch (error) {\n                Logger.error(error as string);\n                process.exit(-1);\n            }\n\n            const buildFilesToIgnore = BUILD_FILE_BLOCK_LIST.map((path) => join(projectPath, path));\n\n            const gitignoreEntries = readFileLinesAsArray(join(projectPath, '.gitignore'));\n            const sourceFilesToIgnore = [...gitignoreEntries, ...SOURCE_FILE_BLOCK_LIST].map((path) =>\n                join(projectPath, path),\n            );\n\n            const request = {\n                build_files: await makeFilesDict(join(projectPath, distPath), buildFilesToIgnore),\n                source_files: await makeFilesDict(join(projectPath), sourceFilesToIgnore),\n            };\n\n            if (!dryRun) {\n                Logger.info('Sending the files to Frontify Marketplace...');\n\n                const httpClient = new HttpClient(instanceUrl);\n\n                const accessToken = Configuration.get('tokens.access_token');\n\n                try {\n                    await httpClient.put(`/api/marketplace/app/${manifest.appId}`, request, {\n                        headers: { Authorization: `Bearer ${accessToken}` },\n                    });\n\n                    Logger.success('The new version has been pushed.');\n\n                    if (openInBrowser) {\n                        Logger.info('Opening the Frontify Marketplace page...');\n                        await open(`https://${instanceUrl}/marketplace/apps/${manifest.appId}`);\n                    }\n                } catch (error) {\n                    Logger.error('An error occured while deploying:', (error as HttpClientError).responseBody.error);\n                    process.exit(-1);\n                }\n            } else {\n                Logger.success('The command has been executed without any issue.');\n                process.exit(0);\n            }\n        }\n    } catch (error) {\n        Logger.error('The deployment has failed and was aborted due to an error:', error as string);\n        process.exit(-1);\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport Fastify from 'fastify';\nimport FastifyCors from '@fastify/cors';\nimport open from 'open';\n\nimport { Configuration, HttpClient, Logger, getUser, getValidInstanceUrl } from '../utils/index.js';\n\nexport interface OauthRandomCodeChallenge {\n    secret: string;\n    sha256: string;\n}\n\nexport interface OauthAccessTokenApiResponse {\n    access_token: string;\n    refresh_token: string;\n    expires_in: number;\n    token_type: string;\n}\n\nexport class Authenticator {\n    private readonly instanceUrl: string;\n    private readonly port: number;\n\n    private readonly httpClient: HttpClient;\n    private readonly fastifyServer = Fastify();\n\n    private randomChallenge: OauthRandomCodeChallenge | undefined;\n\n    constructor(instanceUrl: string, port = 5600) {\n        this.instanceUrl = instanceUrl;\n        this.port = port;\n\n        this.httpClient = new HttpClient(instanceUrl);\n    }\n\n    serveCallbackServer(): void {\n        this.registerPlugins();\n        this.registerRoutes();\n\n        this.fastifyServer.listen({ port: this.port });\n    }\n\n    private registerRoutes(): void {\n        this.fastifyServer.get<{ Querystring: { code: string } }>('/oauth', async (req, res) => {\n            Logger.info('Access granted, getting access token...');\n            res.send('You can close this window.');\n\n            const tokens = await this.getOauthCredentialDetails(req.query.code);\n            Logger.info('Tokens received, storing tokens...');\n            Configuration.set('tokens', tokens);\n            Configuration.set('instanceUrl', this.instanceUrl);\n\n            const user = await getUser(this.instanceUrl);\n            user && Logger.success(`${`Welcome back ${user.name} (${this.instanceUrl})!`}`);\n\n            process.exit(0);\n        });\n    }\n\n    private registerPlugins(): void {\n        this.fastifyServer.register(FastifyCors);\n    }\n\n    async storeRandomCodeChallenge(): Promise<void> {\n        try {\n            const randomCodeChallenge = await this.httpClient.get<{ data: OauthRandomCodeChallenge }>(\n                '/api/oauth/random',\n            );\n            this.randomChallenge = randomCodeChallenge.data;\n        } catch {\n            throw new Error('An error occured while getting the random challenge.');\n        }\n    }\n\n    getLoginUrl(): string {\n        if (!this.randomChallenge) {\n            throw new Error('Random challenge needs to be defined');\n        }\n\n        const queryParams = [\n            'response_type=code',\n            'client_id=block-cli',\n            'redirect_uri=http://localhost:5600/oauth',\n            'scope=basic:read%2Bblocks:read%2Bblocks:write',\n            `code_challenge=${this.randomChallenge.sha256}`,\n            'code_challenge_method=S256',\n        ].join('&');\n\n        return `https://${this.instanceUrl}/api/oauth/authorize?${queryParams}`;\n    }\n\n    async getOauthCredentialDetails(authorizationCode: string): Promise<OauthAccessTokenApiResponse> {\n        if (!this.randomChallenge) {\n            throw new Error('Random challenge needs to be defined');\n        }\n\n        try {\n            const tokens = await this.httpClient.post<OauthAccessTokenApiResponse>('/api/oauth/accesstoken', {\n                grant_type: 'authorization_code',\n                client_id: 'block-cli',\n                redirect_uri: 'http://localhost:5600/oauth',\n                scope: 'basic:read%2Bblocks:read%2Bblocks:write',\n                code_verifier: this.randomChallenge.secret,\n                code: authorizationCode,\n            });\n\n            return tokens;\n        } catch (error) {\n            throw new Error(`An error occured while getting tokens: ${(error as Error).message}`);\n        }\n    }\n}\n\nexport const loginUser = async (instanceUrl: string, port: number): Promise<void> => {\n    try {\n        const cleanedInstanceUrl = getValidInstanceUrl(instanceUrl);\n        const authenticator = new Authenticator(cleanedInstanceUrl, port);\n        authenticator.serveCallbackServer();\n        await authenticator.storeRandomCodeChallenge();\n\n        const loginUrl = authenticator.getLoginUrl();\n\n        Logger.info('Attempting to open OAuth login page...');\n        Logger.info(\n            `If a browser window doesn't automatically open, please open the following link manually: ${loginUrl}`,\n        );\n        await open(loginUrl);\n    } catch {\n        Logger.error('You need to enter a valid Frontify instance URL.');\n        process.exit(-1);\n    }\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { Logger } from '../utils/logger.js';\nimport { Configuration } from '../utils/configuration.js';\n\nexport const logoutUser = (): void => {\n    Configuration.delete('tokens');\n    //TODO: Call API endpoint\n    Logger.info('You are now logged out.');\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport react from '@vitejs/plugin-react';\nimport { createServer } from 'vite';\nimport { viteExternalsPlugin } from 'vite-plugin-externals';\nimport { Logger } from '../utils/logger.js';\nimport pkg from '../../package.json';\n\nclass DevelopmentServer {\n    constructor(\n        private readonly entryFilePath: string,\n        private readonly port: number,\n        private readonly allowExternal: boolean,\n    ) {}\n\n    async serve(): Promise<void> {\n        try {\n            const viteServer = await createServer({\n                root: process.cwd(),\n                plugins: [\n                    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                    //@ts-ignore\n                    react(),\n                    viteExternalsPlugin({\n                        react: 'React',\n                        'react-dom': 'ReactDOM',\n                    }),\n                ],\n                define: {\n                    'process.env.NODE_ENV': JSON.stringify('development'),\n                },\n                base: `http://localhost:${this.port}/`,\n                appType: 'custom',\n                server: {\n                    port: this.port,\n                    host: this.allowExternal ? '0.0.0.0' : 'localhost',\n                    cors: true,\n                    hmr: {\n                        port: this.port,\n                        host: this.allowExternal ? '0.0.0.0' : 'localhost',\n                        protocol: 'ws',\n                    },\n                },\n            });\n\n            viteServer.middlewares.use('/', (req, res, next) => {\n                if (req.url !== '/') {\n                    return next();\n                }\n\n                res.writeHead(200);\n                return res.end('OK');\n            });\n\n            viteServer.middlewares.use('/_entrypoint', (req, res, next) => {\n                if (req.url !== '/') {\n                    return next();\n                }\n\n                res.setHeader('Content-Type', 'application/json');\n                res.writeHead(200);\n                return res.end(\n                    JSON.stringify({\n                        url: `http://localhost:${this.port}/${this.entryFilePath}`,\n                        entryFilePath: this.entryFilePath,\n                        port: this.port,\n                        version: pkg.version,\n                    }),\n                );\n            });\n\n            const server = await viteServer.listen(this.port, true);\n            server.printUrls();\n        } catch (error) {\n            console.error(error);\n            process.exit(1);\n        }\n    }\n}\n\nexport const createDevelopmentServer = async (\n    entryFilePath: string,\n    port: number,\n    allowExternal: boolean,\n): Promise<void> => {\n    Logger.info('Starting the development server...');\n\n    const developmentServer = new DevelopmentServer(entryFilePath, port, allowExternal);\n    await developmentServer.serve();\n};\n","/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { cac } from 'cac';\nimport prompts from 'prompts';\nimport { exit } from 'node:process';\nimport { join } from 'node:path';\n\nimport {\n    createDeployment,\n    createDevelopmentServer,\n    createNewContentBlock,\n    loginUser,\n    logoutUser,\n} from './commands/index.js';\nimport { getValidInstanceUrl, isValidName } from './utils/index.js';\nimport pkg from '../package.json';\n\nconst cli = cac(pkg.name.split('/')[1]);\n\ncli.command('login [instanceUrl]', 'log in to a Frontify instance')\n    .option('-i, --instance [instanceUrl]', '[string] url of the Frontify instance')\n    .option('-p, --port <port>', '[number] port for the oauth service', {\n        default: process.env.PORT || 5600,\n    })\n    .action(async (instanceUrl: string, options) => {\n        const computedInstanceUrl = instanceUrl || options.instance || process.env.INSTANCE_URL;\n        computedInstanceUrl && prompts.inject([computedInstanceUrl]);\n\n        const { promptedInstanceUrl } = await prompts([\n            {\n                type: 'text',\n                name: 'promptedInstanceUrl',\n                message: 'Enter a Frontify instance URL',\n                initial: 'instanceName.frontify.com',\n                validate: (value: string) => (value.trim() === '' ? 'You need to enter a valid URL.' : true),\n            },\n        ]);\n\n        if (!promptedInstanceUrl) {\n            exit(0);\n        }\n\n        const parsedInstanceUrl = getValidInstanceUrl(promptedInstanceUrl);\n\n        await loginUser(parsedInstanceUrl, options.port);\n    });\n\ncli.command('logout', 'log out of an instance').action(logoutUser);\n\n/**\n * @deprecated `block serve` and `theme serve` will be removed in version 4.0 in favour of `serve`\n */\nfor (const appType of ['block', 'theme']) {\n    cli.command(`${appType} serve`, `[deprecated: use 'serve' instead] serve the ${appType} locally`)\n        .alias(`${appType} dev`)\n        .option('-e, --entryPath, --entry-path <entryPath>', `[string] path to the ${appType} entry file`, {\n            default: join('src', 'index.tsx'),\n        })\n        .option('--port <port>', '[number] specify port', {\n            default: process.env.PORT || 5600,\n        })\n        .option('--allowExternal, --allow-external', '[boolean] allow external IPs to access the server', {\n            default: false,\n        })\n        .action(async (options) => {\n            await createDevelopmentServer(options.entryPath, options.port, options.allowExternal);\n        });\n}\n\ncli.command('serve', 'serve the app locally')\n    .alias('dev')\n    .option('-e, --entryPath, --entry-path <entryPath>', '[string] path to the entry file', {\n        default: join('src', 'index.ts'),\n    })\n    .option('--port <port>', '[number] specify port', {\n        default: process.env.PORT || 5600,\n    })\n    .option('--allowExternal, --allow-external', '[boolean] allow external IPs to access the server', {\n        default: false,\n    })\n    .action(async (options) => {\n        await createDevelopmentServer(options.entryPath, options.port, options.allowExternal);\n    });\n\n/**\n * @deprecated `block deploy` and `theme deploy` will be removed in version 4.0 in favour of `deploy`\n */\nfor (const appType of ['block', 'theme']) {\n    cli.command(`${appType} deploy`, `[deprecated: use 'deploy' instead] deploy the ${appType} to the marketplace`)\n        .option('-e, --entryPath <entryPath>', '[string] path to the entry file', { default: join('src', 'index.tsx') })\n        .option('-o, --outDir <outDir>', '[string] path to the output directory', { default: 'dist' })\n        .option('--dryRun, --dry-run', '[boolean] enable the dry run mode', { default: false })\n        .option('--noVerify, --no-verify', '[boolean] disable the linting and typechecking', { default: false })\n        .option('--open', '[boolean] open the marketplace app page', { default: false })\n        .action(async (options) => {\n            await createDeployment(options.entryPath, options.outDir, {\n                dryRun: options.dryRun,\n                noVerify: options.noVerify,\n                openInBrowser: options.open,\n            });\n        });\n}\n\ncli.command('deploy', 'deploy the app to the marketplace')\n    .option('-e, --entryPath <entryPath>', '[string] path to the entry file', { default: join('src', 'index.ts') })\n    .option('-o, --outDir <outDir>', '[string] path to the output directory', { default: 'dist' })\n    .option('--dryRun, --dry-run', '[boolean] enable the dry run mode', { default: false })\n    .option('--noVerify, --no-verify', '[boolean] disable the linting and typechecking', { default: false })\n    .option('--open', '[boolean] open the marketplace app page', { default: false })\n    .action(async (options) => {\n        await createDeployment(options.entryPath, options.outDir, {\n            dryRun: options.dryRun,\n            noVerify: options.noVerify,\n            openInBrowser: options.open,\n        });\n    });\n\ncli.command('create [appName]', 'create a new marketplace app').action(async (appName: string) => {\n    const { promptedAppName, stylingFramework } = await prompts([\n        {\n            type: 'text',\n            name: 'promptedAppName',\n            message: 'Enter your app name',\n            initial: appName || 'my-frontify-app',\n            validate: (value: string) => {\n                if (value.trim() === '') {\n                    return 'You need to enter an app name.';\n                }\n\n                return isValidName(value);\n            },\n        },\n        {\n            type: 'select',\n            name: 'stylingFramework',\n            message: 'Choose a styling framework',\n            choices: [\n                { title: 'Tailwind', value: 'tailwind' },\n                { title: 'CSS Modules', value: 'css-modules' },\n                { title: 'None', value: 'css' },\n            ],\n        },\n    ]);\n\n    if (!promptedAppName || !stylingFramework) {\n        exit(0);\n    }\n\n    createNewContentBlock(promptedAppName, stylingFramework);\n});\n\n/**\n * @deprecated `block create` and `theme create` will be removed in version 4.0 in favour of `create`\n */\nfor (const appType of ['block', 'theme']) {\n    cli.command(\n        `${appType} create [appName]`,\n        `[deprecated: use 'create' instead] create a ${appType} app locally`,\n    ).action((appName: string) => createNewContentBlock(appName, 'css-modules'));\n}\n\ncli.help();\ncli.version(pkg.version);\n\nconst mergeOldBlockThemeCommands = (cliArgs: string[]) => {\n    const oldCommandIndex = cliArgs.findIndex((value) => value === 'block' || value === 'theme');\n    if (\n        oldCommandIndex !== -1 &&\n        (cliArgs[oldCommandIndex + 1] === 'serve' ||\n            cliArgs[oldCommandIndex + 1] === 'deploy' ||\n            cliArgs[oldCommandIndex + 1] === 'create')\n    ) {\n        cliArgs[oldCommandIndex] = `${cliArgs[oldCommandIndex]} ${cliArgs[oldCommandIndex + 1]}`;\n        cliArgs.splice(oldCommandIndex + 1, 1);\n    }\n\n    return cliArgs;\n};\n\ncli.parse(mergeOldBlockThemeCommands(process.argv));\n"],"names":["compile","projectPath","entryFile","outputName","build","react","viteExternalsPlugin","Configuration","key","value","Conf","getCurrentTime","now","Logger","messages","pc","width","FileNotFoundError","path","isDirectoryEmpty","folderPath","readdirSync","copyFolder","sourceFolderPath","destinationFolderPath","options","mkdirSync","excludePatterns","glob","globToRegExp","file","re","srcFile","resolve","destFile","copyFile","sourceFilePath","destinationFilePath","statSync","copyFileSync","readFile","filePath","readFileSync","readFileAsBase64","readFileLinesAsArray","line","HttpClientError","code","responseBody","HttpClient","baseUrl","method","url","body","response","fetch","responseJson","responseText","errorData","relativeUrl","ParseJsonError","reactiveJson","jsonRaw","jsonParsed","obj","prop","jsonString","writeFileSync","error","updatePackageJsonProjectName","packageJsonPath","packageJson","isValidName","folderName","CommandExecutionError","promiseExec","command","reject","exec","stdout","InvalidInstanceUrlError","getValidInstanceUrl","cleanHost","URL","getUser","instanceUrl","httpClient","accessToken","CONTENT_BLOCK_PREFIX","createNewContentBlock","contentBlockName","template","blockPathInBlue","templateDir","fileURLToPath","blockNameInBlue","makeFilesDict","ignoreGlobs","folderFiles","fastGlob","join","stack","filename","index","BUILD_FILE_BLOCK_LIST","SOURCE_FILE_BLOCK_LIST","createDeployment","entryFileName","distPath","dryRun","noVerify","openInBrowser","user","manifest","buildFilesToIgnore","sourceFilesToIgnore","request","open","Authenticator","port","Fastify","req","res","tokens","FastifyCors","randomCodeChallenge","queryParams","authorizationCode","loginUser","cleanedInstanceUrl","authenticator","loginUrl","logoutUser","DevelopmentServer","entryFilePath","allowExternal","viteServer","createServer","next","pkg","createDevelopmentServer","cli","cac","computedInstanceUrl","prompts","promptedInstanceUrl","exit","parsedInstanceUrl","appType","appName","promptedAppName","stylingFramework","mergeOldBlockThemeCommands","cliArgs","oldCommandIndex"],"mappings":"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"}